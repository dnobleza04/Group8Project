<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Employee Login</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<style>
body {
    font-family: 'Open Sans', Arial, sans-serif;
    margin: 0;
    min-height: 100vh;
    background: #EAF3FF;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #2D3E50;
}
h1 {
    margin: 0 0 24px;
    text-align: center;
    font-family: 'Inter', 'Montserrat', Arial, sans-serif;
    font-weight: 800;
    color: #2D3E50;
}
.box {
    width: 520px;
    max-width: calc(100vw - 40px);
    background: #ffffff;
    padding: 32px;
    border-radius: 8px;
    box-shadow: 0 10px 24px rgba(45, 62, 80, 0.16);
}
input {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    margin-bottom: 18px;
    border: 1px solid #D7DEE3;
    border-radius: 8px;
    box-sizing: border-box;
    font-family: 'Open Sans', Arial, sans-serif;
}
button {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    background: #3498DB;
    color: #fff;
    cursor: pointer;
    font-family: 'Open Sans', Arial, sans-serif;
}
button:hover {
    background: #2d87c5;
}
.msg {
    margin-top: 16px;
    font-size: 14px;
    text-align: center;
    color: red;
}
</style>

<script>

function apiUrl(method) {
    return "ProjectServices.asmx/" + method;
}

function setMessage(text, color) {
    const msg = document.getElementById("msg");
    msg.style.color = color || "red";
    msg.textContent = text || "";
}

async function postJson(method, payload) {
    const res = await fetch(apiUrl(method), {
        method: "POST",
        headers: {
            "Content-Type": "application/json; charset=utf-8"
        },
        body: JSON.stringify(payload || {})
    });

    const text = await res.text();
    let parsed = null;

    try {
        parsed = JSON.parse(text);
    } catch (e) {
        throw new Error("Invalid server response.");
    }

    if (!res.ok) {
        throw new Error(parsed && parsed.Message ? parsed.Message : "Request failed.");
    }

    return parsed;
}

async function checkExistingSession() {
    try {
        const res = await postJson("GetAccessStatus", {});
        if (!res || typeof res.d === "undefined") {
            return;
        }

        let access = res.d;
        if (typeof access === "string") {
            try { access = JSON.parse(access); } catch (e) {}
        }

        if (access && access.loggedIn && access.verified) {
            window.location.href = "dashboard.html";
            return;
        }

        if (access && access.loggedIn && !access.verified) {
            setMessage("Access Denied", "red");
        }
    } catch (e) {
    }
}

async function doLogin() {
    setMessage("", "red");

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    if (!email || !password) {
        setMessage("Please enter email and password.", "red");
        return;
    }

    setMessage("Logging in...", "#333");

    try {
        const res = await postJson("EmployeeLogin", {
            email: email,
            password: password
        });

        if (!res || typeof res.d === "undefined") {
            setMessage("Unexpected server response.", "red");
            return;
        }

        let data = res.d;
        if (typeof data === "string") {
            try { data = JSON.parse(data); } catch (e) {}
        }

        if (data && data.success) {
            window.location.href = "dashboard.html";
            return;
        }

        setMessage((data && data.message) ? data.message : "Invalid credentials.", "red");
    } catch (e) {
        setMessage("Login failed: " + e.message, "red");
    }
}

document.addEventListener("DOMContentLoaded", function () {
    checkExistingSession();

    document.querySelector("button").addEventListener("click", function () {
        doLogin();
    });

    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");

    function onKeyDown(e) {
        if (e.key === "Enter") {
            doLogin();
        }
    }

    emailInput.addEventListener("keydown", onKeyDown);
    passwordInput.addEventListener("keydown", onKeyDown);

    function clearMsg() {
        setMessage("", "red");
    }

    emailInput.addEventListener("input", clearMsg);
    passwordInput.addEventListener("input", clearMsg);
});

</script>
</head>

<body>

<div class="box">
    <h1>Employee Login</h1>

    <input id="email" type="text" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />

    <button onclick="doLogin()">Login</button>

    <div class="msg" id="msg"></div>
</div>

</body>
</html>